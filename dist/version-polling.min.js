/*!
  * version-polling v1.1.5
  * (c) 2023 JoeshuTT
  * @license MIT
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VersionPolling={})}(this,(function(t){"use strict";function e(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,e||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function i(){let t,e;return self.onmessage=i=>{let a=i.data.code;e=Object.assign({},e,i.data.data);const{htmlFileUrl:o,lastEtag:n,appETagKey:s,immediate:l,pollingInterval:r}=e,c=()=>{fetch(o,{method:"HEAD",cache:"no-cache"}).then((t=>{const e=t.headers.get("etag");n!==e&&self.postMessage({appETagKey:s,lastEtag:n,etag:e})}))};"pause"===a?(clearInterval(t),t=null):(l&&c(),t=setInterval(c,r))},self}let a;const o={appETagKey:"__APP_ETAG__",pollingInterval:3e5,immediate:!0,htmlFileUrl:`${location.origin}${location.pathname}`,silent:!1};function n(){"hidden"===document.visibilityState?a.postMessage({code:"pause"}):a.postMessage({code:"resume"})}class s{constructor(t){e(this,"options",void 0),e(this,"appEtag",""),this.options=Object.assign({},o,t),this.init()}async init(){const{appETagKey:t,htmlFileUrl:e}=this.options;if(!localStorage.getItem(`${t}`)){const t=(await fetch(e,{method:"HEAD",cache:"no-cache"})).headers.get("etag");this.appEtag=t,localStorage.setItem(`${this.options.appETagKey}`,t)}this.start()}start(){const{appETagKey:t,pollingInterval:e,immediate:o,htmlFileUrl:s,silent:l}=this.options;l||(a=function(t){const e=new Blob(["("+t.toString()+")()"]),i=window.URL.createObjectURL(e),a=new Worker(i);return window.URL.revokeObjectURL(i),a}(i),a.postMessage({code:"start",data:{appETagKey:t,htmlFileUrl:s,pollingInterval:e,immediate:o,lastEtag:localStorage.getItem(`${t}`)}}),a.onmessage=t=>{const{lastEtag:e,etag:i}=t.data;var a,o;(this.appEtag=i,e!==i)&&(this.stop(),null===(a=(o=this.options).onUpdate)||void 0===a||a.call(o,this))},document.addEventListener("visibilitychange",n))}stop(){a&&(a.terminate(),document.removeEventListener("visibilitychange",n))}onRefresh(){localStorage.setItem(`${this.options.appETagKey}`,this.appEtag),window.location.reload()}onCancel(){localStorage.removeItem(`${this.options.appETagKey}`)}}t.VersionPolling=s,t.createVersionPolling=function(t){return new s(t)}}));
