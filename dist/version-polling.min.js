/*!
  * version-polling v1.0.0
  * (c) 2023 JoeshuTT
  * @license MIT
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).VersionPolling={})}(this,(function(e){"use strict";function t(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function a(){let e,t;return self.onmessage=a=>{let o=a.data.code;t=Object.assign({},t,a.data.data);const{htmlFileUrl:n,lastEtag:i,appETagKey:s,immediate:l,pollingInterval:r}=t,c=()=>{fetch(n,{method:"HEAD",cache:"no-cache"}).then((e=>{const t=e.headers.get("etag");i!==t&&self.postMessage({appETagKey:s,lastEtag:i,etag:t})}))};"pause"===o?(clearInterval(e),e=null):(l&&c(),e=setInterval(c,r))},self}let o,n="__APP_ETAG__";class i{constructor(e){t(this,"options",void 0),t(this,"appEtag",""),this.options=e,this.init()}async init(){const{appETagKey:e=n,pollingInterval:t=3e5,immediate:i=!0,htmlFileUrl:s=`${location.origin}${location.pathname}`,silent:l=!1}=this.options;if(!localStorage.getItem(`${e}`)){const e=(await fetch(s,{method:"HEAD",cache:"no-cache"})).headers.get("etag");this.appEtag=e,localStorage.setItem(`${this.options.appETagKey}`,e)}l||(o=function(e){const t=new Blob(["("+e.toString()+")()"]),a=window.URL.createObjectURL(t),o=new Worker(a);return window.URL.revokeObjectURL(a),o}(a),o.postMessage({code:"start",data:{appETagKey:e,htmlFileUrl:s,pollingInterval:t,immediate:i,lastEtag:localStorage.getItem(`${e}`)}}),o.onmessage=e=>{const{lastEtag:t,etag:a}=e.data;var n,i;(this.appEtag=a,t!==a)&&(o.terminate(),null===(n=(i=this.options).onUpdate)||void 0===n||n.call(i,this))},document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState?o.postMessage({code:"pause"}):o.postMessage({code:"resume"})})))}onRefresh(){localStorage.setItem(`${this.options.appETagKey}`,this.appEtag),window.location.reload()}onCancel(){}}e.VersionPolling=i,e.createVersionPolling=function(e){return new i(e)}}));
