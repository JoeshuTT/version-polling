/*!
  * version-polling v1.2.2
  * (c) 2023 JoeshuTT
  * @license MIT
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VersionPolling={})}(this,(function(t){"use strict";function e(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function n(){let t,e=null;return self.onmessage=n=>{let i=n.data.code;t=Object.assign({},t,n.data.data);const{htmlFileUrl:o,lastEtag:s,appETagKey:a,pollingInterval:l,silentPollingInterval:r}=t,c=()=>{fetch(o,{method:"HEAD",cache:"no-cache"}).then((t=>{if(200!==Number(t.status))return;const e=t.headers.get("etag");s!==e&&self.postMessage({appETagKey:a,lastEtag:s,etag:e})}))};"pause"===i?e&&(clearInterval(e),e=null):(c(),r||(e=setInterval(c,l)))},self}let i;const o={appETagKey:"__APP_ETAG__",pollingInterval:3e5,htmlFileUrl:`${location.origin}${location.pathname}`,silent:!1,silentPollingInterval:!1,silentPageVisibility:!1,forceUpdate:!1};let s=!1;function a(){"visible"===document.visibilityState?i.postMessage({code:"resume"}):i.postMessage({code:"pause"})}class l{constructor(t){e(this,"options",void 0),e(this,"appEtag",""),this.options=Object.assign({},o,t),this.init()}async init(){const{htmlFileUrl:t}=this.options,e=await fetch(t,{method:"HEAD",cache:"no-cache"});if(200!==Number(e.status))throw new Error(`[version-polling]: status is ${e.status}`);const n=e.headers.get("etag");if(null==n)throw new Error("[version-polling]: etag is null");this.appEtag=n,localStorage.setItem(`${this.options.appETagKey}`,n),this.start()}start(){const{appETagKey:t,pollingInterval:e,htmlFileUrl:o,silent:l,silentPollingInterval:r,silentPageVisibility:c}=this.options;l||(i=function(t){const e=new Blob(["("+t.toString()+")()"]),n=window.URL.createObjectURL(e),i=new Worker(n);return window.URL.revokeObjectURL(n),i}(n),i.postMessage({code:"start",data:{appETagKey:t,pollingInterval:e,htmlFileUrl:o,silentPollingInterval:r,lastEtag:this.appEtag}}),i.onmessage=t=>{const{lastEtag:e,etag:n}=t.data;e!==n&&(this.stop(),this.options.onUpdate?.(this))},c||s||(document.addEventListener("visibilitychange",a),s=!0))}stop(){i&&(i.terminate(),s&&(document.removeEventListener("visibilitychange",a),s=!1))}onRefresh(){window.location.reload()}onCancel(){this.options.forceUpdate&&this.start()}}t.VersionPolling=l,t.createVersionPolling=function(t){return new l(t)}}));
